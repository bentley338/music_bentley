<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - MelodyVerse</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="app_icon.png" type="image/png">
    <style>
        /* Gaya spesifik untuk halaman admin (gunakan CSS dari style.css utama untuk konsistensi) */
        body {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            min-height: 100vh;
        }

        .admin-container {
            padding: 40px;
            text-align: center;
            background: var(--player-bg-dark);
            backdrop-filter: blur(var(--blur-intensity)) saturate(150%);
            -webkit-backdrop-filter: blur(var(--blur-intensity)) saturate(15-%);
            border: 1px solid var(--player-border);
            border-radius: var(--border-radius-main);
            box-shadow: 0 15px 50px var(--shadow-deep);
            max-width: 800px; /* Lebih lebar untuk konten lebih banyak */
            width: 90%;
            margin: auto;
            margin-top: 100px; /* Ruang dari header */
            margin-bottom: 20px;
            transition: background 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
        }

        .admin-container h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5em; /* Judul lebih besar */
            margin-bottom: 30px;
            transition: color 0.5s ease;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.7);
        }

        #login-section, #admin-panel {
            padding: 20px;
            margin-top: 20px;
            border-radius: var(--border-radius-sm);
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.5s ease, border-color 0.5s ease;
            text-align: left; /* Teks rata kiri di dalam panel */
        }
        body.light-mode #login-section,
        body.light-mode #admin-panel {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--secondary-text);
            font-size: 0.95em;
            transition: color 0.5s ease;
        }

        .input-group input[type="text"],
        .input-group input[type="password"],
        .input-group textarea,
        .admin-section-content input[type="text"],
        .admin-section-content select { /* Added select for default song */
            width: calc(100% - 20px);
            padding: 10px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: var(--border-radius-sm);
            color: var(--input-text);
            font-size: 1em;
            outline: none;
            transition: all 0.3s ease;
        }
        body.light-mode .input-group input,
        body.light-mode .input-group textarea,
        body.light-mode .admin-section-content input,
        body.light-mode .admin-section-content select {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.15);
            color: var(--input-text);
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .admin-section-content input:focus,
        .admin-section-content select:focus {
            border-color: var(--accent-purple);
            box-shadow: 0 0 8px rgba(138, 43, 226, 0.5);
        }
        body.light-mode .input-group input:focus,
        body.light-mode .admin-section-content input:focus,
        body.light-mode .admin-section-content select:focus {
            border-color: var(--accent-red);
            box-shadow: 0 0 8px rgba(255, 69, 0, 0.5);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .admin-btn {
            background: var(--accent-purple);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            margin-top: 10px;
        }

        .admin-btn:hover {
            background-color: var(--accent-red);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        #admin-panel {
            display: none;
            padding: 30px; /* Padding lebih banyak untuk tampilan lebih bersih */
        }

        .admin-section {
            margin-bottom: 40px; /* Jarak antar bagian */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Pemisah */
            padding-bottom: 20px;
        }
        .admin-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        body.light-mode .admin-section {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }


        .admin-section h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            color: var(--primary-text);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center; /* Pusatkan judul bagian */
        }

        .admin-section-content {
            background: rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius-sm);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        body.light-mode .admin-section-content {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }


        .song-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }

        .song-list li {
            display: flex;
            flex-wrap: wrap; /* Izinkan pembungkus di mobile */
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius-sm);
            border-left: 5px solid var(--accent-purple);
            transition: background 0.3s ease, border-left-color 0.3s ease;
        }
        body.light-mode .song-list li {
            background: rgba(0, 0, 0, 0.03);
            border-left-color: var(--accent-red);
        }

        .song-list li .checkbox-container {
            margin-right: 10px;
        }
        .song-list li .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            vertical-align: middle;
        }

        .song-list li .song-info {
            flex-grow: 1;
            margin-right: 10px; /* Jarak dari tindakan */
        }
        .song-list li .song-info h3 {
            margin: 0;
            font-size: 1.1em;
            color: var(--primary-text);
        }
        .song-list li .song-info p {
            margin: 3px 0 0;
            font-size: 0.9em;
            color: var(--secondary-text);
        }
        .song-list li .song-info small {
            display: block;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 5px;
            word-break: break-all; /* Memecah nama file yang panjang */
        }
        body.light-mode .song-list li .song-info small {
            color: rgba(0, 0, 0, 0.4);
        }

        .song-list li .actions {
            display: flex;
            gap: 10px;
            margin-top: 10px; /* Dorong tindakan ke baris baru saat melipat */
        }
        @media (min-width: 481px) { /* Mencegah pembungkus di layar yang lebih besar */
            .song-list li .actions {
                margin-top: 0;
            }
        }


        .song-list li .actions .action-btn {
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            color: var(--primary-text);
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        body.light-mode .song-list li .actions .action-btn {
            background: rgba(0, 0, 0, 0.05);
            border-color: var(--button-border);
            color: var(--primary-text);
        }


        .song-list li .actions .action-btn:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-red);
        }
        body.light-mode .song-list li .actions .action-btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
            border-color: var(--accent-purple);
        }

        .action-btn.delete {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        .action-btn.delete:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .action-btn.edit {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
        }
        .action-btn.edit:hover {
            background-color: #0056b3;
            border-color: #004085;
        }
        .action-btn.move-btn {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
        }
        .action-btn.move-btn:hover {
            background-color: #545b62;
            border-color: #4a4e53;
        }


        /* Gaya Modal (sama seperti index.html untuk konsistensi) */
        .modal {
            display: none;
            position: fixed;
            z-index: 101;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            animation: fadeInModal 0.3s ease-out forwards;
        }
        .modal.visible { display: flex; }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }

        .modal-content {
            background: var(--player-bg-dark);
            backdrop-filter: blur(var(--blur-intensity)) saturate(150%);
            -webkit-backdrop-filter: blur(var(--blur-intensity)) saturate(150%);
            border: 1px solid var(--player-border);
            border-radius: var(--border-radius-main);
            box-shadow: 0 15px 50px var(--shadow-deep);
            padding: 30px;
            width: 80%;
            max-width: 500px;
            text-align: left;
            position: relative;
            animation: slideInModal 0.4s ease-out forwards;
        }
        @keyframes slideInModal { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-content h3 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-text);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .close-button {
            color: var(--secondary-text);
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--accent-red);
            text-decoration: none;
            cursor: pointer;
        }

        .modal .input-group {
            margin-bottom: 15px;
        }
        .modal .admin-btn {
            width: 100%;
            margin-top: 20px;
        }

        .back-home-btn {
            display: inline-block;
            margin-top: 40px;
            padding: 15px 30px;
            background: var(--accent-purple);
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .back-home-btn:hover {
            background-color: var(--accent-red);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.7);
        }

        #reload-message {
            color: green;
            margin-top: 15px;
            font-weight: 500;
        }

        .file-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .file-input-wrapper input[type="file"] {
            flex-grow: 1;
            padding: 8px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: var(--border-radius-sm);
            color: var(--input-text);
            font-size: 1em;
            outline: none;
            cursor: pointer;
        }
        body.light-mode .file-input-wrapper input[type="file"] {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.15);
            color: var(--input-text);
        }

        .import-export-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .import-export-buttons .admin-btn {
            flex: 1 1 auto;
            min-width: 120px;
            margin-top: 0;
        }
        /* Style for hidden file input's label */
        .import-export-buttons input[type="file"] {
            display: none;
        }
        .import-export-label {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            flex: 1 1 auto;
            min-width: 120px;
        }
        .import-export-label:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* New style for URL import section */
        .import-url-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed rgba(255,255,255,0.1);
        }
        body.light-mode .import-url-section {
            border-top: 1px dashed rgba(0,0,0,0.1);
        }
        .import-url-section .input-group {
            margin-bottom: 10px;
        }
        .import-url-section .admin-btn {
            width: auto;
            padding: 10px 20px;
            margin-top: 5px;
        }


        /* Album art preview */
        .album-art-preview {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
            margin-left: 10px;
            border: 1px solid var(--player-border);
            vertical-align: middle;
            display: inline-block;
        }

        /* Batch edit controls */
        .batch-edit-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: flex-end;
            align-items: center;
        }
        .batch-edit-controls .admin-btn {
            margin-top: 0;
            padding: 8px 15px;
            font-size: 0.9em;
        }
        .batch-edit-controls input[type="checkbox"] {
            margin-right: 5px;
            width: 18px;
            height: 18px;
            vertical-align: middle;
        }
        .batch-edit-controls label {
            font-size: 0.9em;
            color: var(--secondary-text);
            margin-bottom: 0;
            display: flex;
            align-items: center;
        }

        #admin-activity-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: var(--border-radius-sm);
            padding: 10px;
            font-family: monospace;
            font-size: 0.8em;
            color: var(--secondary-text);
            text-align: left;
            white-space: pre-wrap; /* Preserve whitespace and wrap long lines */
            word-wrap: break-word;
        }
        body.light-mode #admin-activity-log {
            background: rgba(0,0,0,0.02);
            border: 1px solid rgba(0,0,0,0.1);
        }
        /* Style for log entries, if using ul/li */
        #admin-activity-log ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #admin-activity-log li {
            padding: 5px 0;
            border-bottom: 1px dashed rgba(255,255,255,0.05);
        }
        #admin-activity-log li:last-child {
            border-bottom: none;
        }

        /* Global message editor specific styles */
        #global-message-editor textarea {
            min-height: 100px;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .global-message-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .global-message-controls .admin-btn {
            flex-grow: 1;
            min-width: 140px;
        }


        /* Panel Admin Responsif */
        @media (max-width: 768px) {
            .admin-container {
                padding: 30px;
            }
            .admin-container h2 {
                font-size: 2em;
            }
            .admin-section h3 {
                font-size: 1.5em;
            }
            .song-list li {
                flex-direction: column;
                align-items: flex-start;
            }
            .song-list li .song-info {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            .song-list li .actions {
                width: 100%;
                justify-content: flex-end;
                margin-top: 0;
            }
            .back-home-btn {
                padding: 12px 25px;
                font-size: 0.9em;
            }
            .import-export-buttons .admin-btn,
            .import-export-label {
                min-width: unset;
                width: 100%;
            }
            .import-export-buttons {
                flex-direction: column;
            }
            .batch-edit-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .batch-edit-controls .admin-btn {
                width: 100%;
            }
            .batch-edit-controls label {
                width: 100%;
                justify-content: flex-start;
            }
            .global-message-controls {
                flex-direction: column;
            }
        }
        @media (max-width: 480px) {
            .admin-container {
                padding: 20px;
            }
            .admin-container h2 {
                font-size: 1.8em;
            }
            .admin-section h3 {
                font-size: 1.3em;
            }
            .input-group label {
                font-size: 0.9em;
            }
            .input-group input,
            .input-group textarea,
            .admin-section-content input,
            .admin-section-content select {
                font-size: 0.9em;
                padding: 8px;
            }
            .admin-btn {
                padding: 8px 15px;
                font-size: 0.9em;
            }
            .song-list li .song-info h3 {
                font-size: 1em;
            }
            .song-list li .song-info p, .song-list li .song-info small {
                font-size: 0.8em;
            }
            .song-list li .actions .action-btn {
                padding: 6px 10px;
                font-size: 0.8em;
            }
            .modal-content {
                padding: 20px;
            }
            .modal-content h3 {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="video-background">
        <video id="background-video" autoplay loop muted playsinline>
            <source src="abstract_wave_bg.mp4" type="video/mp4">
            Browser Anda tidak mendukung video HTML5.
        </video>
        <div class="video-overlay"></div>
    </div>

    <header>
        <div class="app-branding">
            <h1 id="app-title-new" class="app-title-new">
                <i class="fas fa-music"></i> MelodyVerse
            </h1>
        </div>
        <div class="header-right-controls">
            <button id="toggle-theme-btn" class="btn btn-icon" aria-label="Toggle Tema">
                <i class="fas fa-sun"></i>
            </button>
        </div>
    </header>

    <div class="container">
        <div class="admin-container">
            <h2>Panel Admin</h2>

            <div id="login-section" class="admin-section">
                <h3>Login Admin</h3>
                <div class="admin-section-content">
                    <div class="input-group">
                        <label for="admin-password">Password:</label>
                        <input type="password" id="admin-password" placeholder="Masukkan password admin">
                    </div>
                    <button id="login-btn" class="admin-btn">Login</button>
                    <p id="login-message" style="color: red; margin-top: 10px;"></p>
                </div>
            </div>

            <div id="admin-panel">

                <div class="admin-section" id="global-message-editor">
                    <h3>Pengaturan Pesan Global</h3>
                    <div class="admin-section-content">
                        <p style="font-size: 0.9em; color: var(--secondary-text); margin-bottom: 15px;">
                            Ketik pesan di sini. Untuk membuatnya terlihat oleh semua orang, Anda perlu **menyalin pesan ini** dan **menempelkannya secara manual** ke dalam kode `index.html` Anda di GitHub.
                        </p>
                        <div class="input-group">
                            <label for="global-message-text-input">Pesan:</label>
                            <textarea id="global-message-text-input" placeholder="Tulis pesan global di sini..."></textarea>
                        </div>
                        <div class="global-message-controls">
                            <button id="apply-global-message-local-btn" class="admin-btn"><i class="fas fa-save"></i> Terapkan Perubahan Lokal</button>
                            <button id="copy-global-message-btn" class="admin-btn" style="background-color: #007bff;"><i class="fas fa-copy"></i> Salin Pesan untuk GitHub</button>
                        </div>
                        <p id="global-message-status" style="color: green; margin-top: 10px;"></p>
                        <p style="font-size: 0.8em; color: var(--secondary-text); margin-top: 10px;">
                            **Cara Menyebarkan Pesan Global:**<br>
                            1. Salin pesan di atas dengan tombol "Salin Pesan untuk GitHub".<br>
                            2. Buka file `index.html` di editor kode/GitHub Anda.<br>
                            3. Cari `div` dengan ID `global-message-text` (sekitar baris 40-an).<br>
                            4. Tempel (paste) pesan yang Anda salin di dalamnya.<br>
                            5. Pastikan `div` dengan ID `global-message-display` di `index.html` memiliki `style="display: block;"` jika Anda ingin pesan langsung terlihat.<br>
                            6. Simpan perubahan dan push ke GitHub Pages.
                        </p>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>Kelola Lagu</h3>
                    <div class="admin-section-content">
                        <div class="input-group">
                            <label for="manage-song-search">Cari Lagu:</label>
                            <input type="text" id="manage-song-search" placeholder="Cari judul atau artis...">
                        </div>
                        <div class="batch-edit-controls">
                            <label><input type="checkbox" id="select-all-songs"> Pilih Semua</label>
                            <button id="edit-selected-btn" class="admin-btn" disabled><i class="fas fa-edit"></i> Edit Terpilih</button>
                            <button id="delete-selected-btn" class="admin-btn" style="background-color: #dc3545;" disabled><i class="fas fa-trash-alt"></i> Hapus Terpilih</button>
                        </div>
                        <ul id="manage-song-list" class="song-list">
                            </ul>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>Pengaturan Lagu Default</h3>
                    <div class="admin-section-content">
                        <p style="font-size: 0.9em; color: var(--secondary-text); margin-bottom: 15px;">Lagu ini akan diputar saat playlist utama kosong.</p>
                        <div class="input-group">
                            <label for="default-song-select">Pilih Lagu Default:</label>
                            <select id="default-song-select">
                                <option value="">-- Pilih dari Playlist --</option>
                            </select>
                        </div>
                        <button id="set-default-song-btn" class="admin-btn">Atur Lagu Default</button>
                        <p id="default-song-message" style="color: green; margin-top: 10px;"></p>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>Import / Export Playlist</h3>
                    <div class="admin-section-content">
                        <div class="import-export-buttons">
                            <label for="import-playlist-file" class="import-export-label"><i class="fas fa-file-import"></i> Import dari File</label>
                            <input type="file" id="import-playlist-file" accept=".json">
                            <button id="export-playlist-btn" class="admin-btn"><i class="fas fa-file-export"></i> Export ke File</button>
                        </div>
                        <div class="import-url-section">
                            <p style="font-size: 0.9em; color: var(--secondary-text); margin-bottom: 10px;">Atau impor playlist dari URL Gist/Host Statis (mis: `https://gist.githubusercontent.com/.../playlist.json`)</p>
                            <div class="input-group">
                                <label for="import-playlist-url">URL Playlist:</label>
                                <input type="text" id="import-playlist-url" placeholder="Masukkan URL playlist JSON">
                            </div>
                            <button id="import-from-url-btn" class="admin-btn"><i class="fas fa-link"></i> Import dari URL</button>
                        </div>
                        <p id="import-export-message" style="color: green; margin-top: 10px;"></p>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>Log Aktivitas Admin</h3>
                    <div class="admin-section-content">
                        <div id="admin-activity-log">
                            <p>Tidak ada aktivitas yang tercatat.</p>
                        </div>
                    </div>
                </div>


                <div class="admin-section">
                    <h3>Opsi Lain</h3>
                    <div class="admin-section-content">
                        <button id="clear-data-btn" class="admin-btn" style="background-color: #ffc107; color: black;"><i class="fas fa-eraser"></i> Bersihkan Semua Data Lagu</button>
                        <p style="font-size: 0.9em; color: var(--secondary-text); margin-top: 10px;">(Ini akan menghapus semua lagu yang tersimpan di browser Anda)</p>
                        <button id="reload-app-btn" class="admin-btn" style="background-color: #17a2b8;"><i class="fas fa-sync-alt"></i> Muat Ulang Aplikasi (Client Side)</button>
                        <p id="reload-message"></p>
                    </div>
                </div>
            </div>

            <a href="index.html" class="back-home-btn">Kembali ke Pemutar Musik</a>
        </div>
    </div>

    <div id="editSongModal" class="modal">
        <div class="modal-content glass-effect">
            <span class="close-button edit-modal-close">&times;</span>
            <h3>Edit Lagu</h3>
            <input type="hidden" id="edit-song-index">
            <div class="input-group">
                <label for="edit-song-title">Judul Lagu:</label>
                <input type="text" id="edit-song-title">
            </div>
            <div class="input-group">
                <label for="edit-song-artist">Artis:</label>
                <input type="text" id="edit-song-artist">
            </div>
            <div class="input-group">
                <label for="edit-song-src">Nama File MP3:</label>
                <input type="text" id="edit-song-src" disabled> </div>
            <div class="input-group">
                <label for="edit-song-album-art">Nama File Album Art:</label>
                <input type="text" id="edit-song-album-art">
                <img id="edit-album-art-preview" class="album-art-preview" src="album_art_default.jpg" alt="Album Art Preview">
            </div>
            <div class="input-group">
                <label for="edit-song-info">Info Lagu (Gunakan &lt;br&gt; untuk baris baru):</label>
                <textarea id="edit-song-info"></textarea>
            </div>
            <button id="save-edit-btn" class="admin-btn">Simpan Perubahan</button>
        </div>
    </div>

    <div id="batchEditModal" class="modal">
        <div class="modal-content glass-effect">
            <span class="close-button batch-edit-modal-close">&times;</span>
            <h3>Edit Lagu Terpilih</h3>
            <p style="color: var(--secondary-text); font-size: 0.9em; margin-bottom: 20px;">Isi hanya field yang ingin Anda ubah. Biarkan kosong untuk tidak mengubah.</p>
            <div class="input-group">
                <label for="batch-edit-artist">Artis Baru:</label>
                <input type="text" id="batch-edit-artist" placeholder="Biarkan kosong untuk tidak mengubah">
            </div>
            <div class="input-group">
                <label for="batch-edit-info">Info Lagu Baru (Gunakan &lt;br&gt; untuk baris baru):</label>
                <textarea id="batch-edit-info" placeholder="Biarkan kosong untuk tidak mengubah"></textarea>
            </div>
            <button id="save-batch-edit-btn" class="admin-btn">Terapkan Perubahan Massal</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const adminPasswordInput = document.getElementById('admin-password');
            const loginBtn = document.getElementById('login-btn');
            const loginMessage = document.getElementById('login-message');
            const loginSection = document.getElementById('login-section');
            const adminPanel = document.getElementById('admin-panel');

            // Global Message elements
            const globalMessageTextInput = document.getElementById('global-message-text-input');
            const applyGlobalMessageLocalBtn = document.getElementById('apply-global-message-local-btn');
            const copyGlobalMessageBtn = document.getElementById('copy-global-message-btn');
            const globalMessageStatus = document.getElementById('global-message-status');

            const manageSongList = document.getElementById('manage-song-list');
            const manageSongSearchInput = document.getElementById('manage-song-search');

            const editSongModal = document.getElementById('editSongModal');
            const editModalCloseBtn = document.querySelector('.edit-modal-close');
            const editSongIndexInput = document.getElementById('edit-song-index');
            const editSongTitleInput = document.getElementById('edit-song-title');
            const editSongArtistInput = document.getElementById('edit-song-artist');
            const editSongSrcInput = document.getElementById('edit-song-src');
            const editSongAlbumArtInput = document.getElementById('edit-song-album-art');
            const editAlbumArtPreview = document.getElementById('edit-album-art-preview');
            const editSongInfoInput = document.getElementById('edit-song-info');
            const saveEditBtn = document.getElementById('save-edit-btn');

            const clearDataBtn = document.getElementById('clear-data-btn');
            const reloadAppBtn = document.getElementById('reload-app-btn');
            const reloadMessage = document.getElementById('reload-message');

            const importPlaylistFile = document.getElementById('import-playlist-file');
            const exportPlaylistBtn = document.getElementById('export-playlist-btn');
            const importPlaylistUrlInput = document.getElementById('import-playlist-url');
            const importFromUrlBtn = document.getElementById('import-from-url-btn');
            const importExportMessage = document.getElementById('import-export-message');

            // Batch Edit elements
            const selectAllSongsCheckbox = document.getElementById('select-all-songs');
            const editSelectedBtn = document.getElementById('edit-selected-btn');
            const deleteSelectedBtn = document.getElementById('delete-selected-btn');
            const batchEditModal = document.getElementById('batchEditModal');
            const batchEditModalCloseBtn = document.querySelector('.batch-edit-modal-close');
            const batchEditArtistInput = document.getElementById('batch-edit-artist');
            const batchEditInfoInput = document.getElementById('batch-edit-info');
            const saveBatchEditBtn = document.getElementById('save-batch-edit-btn');
            let selectedSongIndexes = new Set();

            // Default Song Settings elements
            const defaultSongSelect = document.getElementById('default-song-select');
            const setDefaultSongBtn = document.getElementById('set-default-song-btn');
            const defaultSongMessage = document.getElementById('default-song-message');

            // Admin Activity Log elements
            const adminActivityLogDiv = document.getElementById('admin-activity-log');
            let adminLog = JSON.parse(localStorage.getItem('adminActivityLog')) || [];

            const toggleThemeBtn = document.getElementById('toggle-theme-btn');
            const backgroundVideo = document.getElementById('background-video');

            const ADMIN_PASSWORD = "157299pro";

            let playlist = JSON.parse(localStorage.getItem('musicPlaylist')) || [];

            // --- Admin Activity Log Functions ---
            function addLogEntry(message) {
                const timestamp = new Date().toLocaleString('id-ID', {
                    year: 'numeric', month: 'numeric', day: 'numeric',
                    hour: '2-digit', minute: '2-digit', second: '2-digit'
                });
                adminLog.unshift(`[${timestamp}] ${message}`);
                if (adminLog.length > 50) {
                    adminLog = adminLog.slice(0, 50);
                }
                localStorage.setItem('adminActivityLog', JSON.stringify(adminLog));
                renderAdminLog();
            }

            function renderAdminLog() {
                if (adminLog.length === 0) {
                    adminActivityLogDiv.innerHTML = '<p>Tidak ada aktivitas yang tercatat.</p>';
                } else {
                    adminActivityLogDiv.innerHTML = '<ul>' + adminLog.map(entry => `<li>${entry}</li>`).join('') + '</ul>';
                }
            }

            function renderSongList(searchTerm = '') {
                manageSongList.innerHTML = '';
                selectedSongIndexes.clear();
                updateBatchEditButtons();
                selectAllSongsCheckbox.checked = false;

                const filteredSongs = playlist.filter(song =>
                    song.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    song.artist.toLowerCase().includes(searchTerm.toLowerCase())
                );

                if (filteredSongs.length === 0) {
                    const noSongsLi = document.createElement('li');
                    noSongsLi.style.justifyContent = 'center';
                    noSongsLi.style.backgroundColor = 'transparent';
                    noSongsLi.style.borderLeft = 'none';
                    noSongsLi.style.padding = '10px 0';
                    noSongsLi.style.color = 'var(--secondary-text)';
                    noSongsLi.textContent = "Tidak ada lagu dalam playlist.";
                    manageSongList.appendChild(noSongsLi);
                    return;
                }

                filteredSongs.forEach((song, index) => {
                    const originalIndex = playlist.indexOf(song);
                    if (originalIndex === -1) return;

                    const li = document.createElement('li');
                    li.innerHTML = `
                        <div class="checkbox-container">
                            <input type="checkbox" class="song-select-checkbox" data-index="${originalIndex}">
                        </div>
                        <div class="song-info">
                            <h3>${song.title}</h3>
                            <p>${song.artist}</p>
                            <small>MP3: ${song.src}<br>Album Art: ${song.albumArt}</small>
                        </div>
                        <div class="actions">
                            <button class="action-btn edit-btn" data-index="${originalIndex}"><i class="fas fa-edit"></i> Edit</button>
                            <button class="action-btn delete-btn" data-index="${originalIndex}"><i class="fas fa-trash-alt"></i> Hapus</button>
                            <button class="action-btn move-up-btn" data-index="${originalIndex}" ${originalIndex === 0 ? 'disabled' : ''}><i class="fas fa-arrow-up"></i></button>
                            <button class="action-btn move-down-btn" data-index="${originalIndex}" ${originalIndex === playlist.length - 1 ? 'disabled' : ''}><i class="fas fa-arrow-down"></i></button>
                        </div>
                    `;
                    manageSongList.appendChild(li);

                    if (selectedSongIndexes.has(originalIndex)) {
                        li.querySelector('.song-select-checkbox').checked = true;
                    }
                });
            }

            function savePlaylist() {
                try {
                    localStorage.setItem('musicPlaylist', JSON.stringify(playlist));
                    window.dispatchEvent(new Event('storage'));
                    console.log("Playlist saved to localStorage.");
                } catch (e) {
                    console.error("Error saving playlist to localStorage:", e);
                    alert("Gagal menyimpan playlist. Mungkin penyimpanan penuh atau ada masalah browser.");
                }
            }

            function isSrcOrAlbumArtDuplicate(src, albumArt, currentIndex = -1) {
                const srcExists = playlist.some((song, index) => index !== currentIndex && song.src.toLowerCase() === src.toLowerCase());
                const albumArtExists = playlist.some((song, index) => index !== currentIndex && song.albumArt.toLowerCase() === albumArt.toLowerCase());
                return { srcExists, albumArtExists };
            }

            // --- Logika Login ---
            loginBtn.addEventListener('click', () => {
                if (adminPasswordInput.value === ADMIN_PASSWORD) {
                    loginSection.style.display = 'none';
                    adminPanel.style.display = 'block';
                    loginMessage.textContent = '';
                    renderSongList();
                    renderDefaultSongSelect();
                    renderAdminLog();
                    loadGlobalMessage(); // Load global message from local storage
                    addLogEntry("Login Admin Berhasil.");
                } else {
                    loginMessage.textContent = 'Password salah!';
                    addLogEntry("Login Admin Gagal (Password Salah).");
                }
                adminPasswordInput.value = '';
            });

            // --- Logika Pengaturan Pesan Global ---
            function loadGlobalMessage() {
                const savedMessage = localStorage.getItem('globalMelodyVerseMessage');
                if (savedMessage) {
                    globalMessageTextInput.value = savedMessage;
                } else {
                    globalMessageTextInput.value = "Selamat datang di MelodyVerse! Nikmati musiknya.";
                }
            }

            applyGlobalMessageLocalBtn.addEventListener('click', () => {
                const message = globalMessageTextInput.value.trim();
                localStorage.setItem('globalMelodyVerseMessage', message);
                globalMessageStatus.style.color = 'green';
                globalMessageStatus.textContent = 'Pesan global tersimpan secara lokal di perangkat ini!';
                addLogEntry(`Pesan global diperbarui secara lokal.`);
                // Trigger an event to potentially update the message on the main page if visible
                window.dispatchEvent(new Event('storage'));
            });

            copyGlobalMessageBtn.addEventListener('click', async () => {
                const message = globalMessageTextInput.value.trim();
                if (!message) {
                    globalMessageStatus.style.color = 'red';
                    globalMessageStatus.textContent = 'Pesan global tidak boleh kosong untuk disalin!';
                    return;
                }
                try {
                    await navigator.clipboard.writeText(message);
                    globalMessageStatus.style.color = 'green';
                    globalMessageStatus.textContent = 'Pesan berhasil disalin! Sekarang tempel di index.html Anda.';
                    addLogEntry(`Pesan global disalin untuk GitHub.`);
                } catch (err) {
                    console.error('Gagal menyalin pesan: ', err);
                    globalMessageStatus.style.color = 'red';
                    globalMessageStatus.textContent = 'Gagal menyalin pesan. Silakan salin manual.';
                }
            });


            // --- Logika Hapus Lagu & Pindah Posisi ---
            manageSongList.addEventListener('click', (event) => {
                const targetDeleteButton = event.target.closest('.delete-btn');
                if (targetDeleteButton) {
                    const indexToDelete = parseInt(targetDeleteButton.dataset.index);
                    if (confirm(`Anda yakin ingin menghapus lagu "${playlist[indexToDelete].title}"?`)) {
                        const songTitle = playlist[indexToDelete].title;
                        playlist.splice(indexToDelete, 1);
                        savePlaylist();
                        renderSongList(manageSongSearchInput.value);
                        renderDefaultSongSelect();
                        addLogEntry(`Menghapus lagu: "${songTitle}"`);
                    }
                }

                const moveUpButton = event.target.closest('.move-up-btn');
                if (moveUpButton) {
                    const indexToMove = parseInt(moveUpButton.dataset.index);
                    if (indexToMove > 0) {
                        const songTitle = playlist[indexToMove].title;
                        [playlist[indexToMove], playlist[indexToMove - 1]] = [playlist[indexToMove - 1], playlist[indexToMove]];
                        savePlaylist();
                        renderSongList(manageSongSearchInput.value);
                        addLogEntry(`Memindahkan lagu "${songTitle}" ke atas.`);
                    }
                }

                const moveDownButton = event.target.closest('.move-down-btn');
                if (moveDownButton) {
                    const indexToMove = parseInt(moveDownButton.dataset.index);
                    if (indexToMove < playlist.length - 1) {
                        const songTitle = playlist[indexToMove].title;
                        [playlist[indexToMove], playlist[indexToMove + 1]] = [playlist[indexToMove + 1], playlist[indexToMove]];
                        savePlaylist();
                        renderSongList(manageSongSearchInput.value);
                        addLogEntry(`Memindahkan lagu "${songTitle}" ke bawah.`);
                    }
                }

                const checkbox = event.target.closest('.song-select-checkbox');
                if (checkbox) {
                    const index = parseInt(checkbox.dataset.index);
                    if (checkbox.checked) {
                        selectedSongIndexes.add(index);
                    } else {
                        selectedSongIndexes.delete(index);
                    }
                    updateBatchEditButtons();
                    if (playlist.length > 0 && selectedSongIndexes.size === playlist.length) {
                        selectAllSongsCheckbox.checked = true;
                    } else {
                        selectAllSongsCheckbox.checked = false;
                    }
                }
            });

            selectAllSongsCheckbox.addEventListener('change', () => {
                const checkboxes = manageSongList.querySelectorAll('.song-select-checkbox');
                selectedSongIndexes.clear();
                checkboxes.forEach(cb => {
                    cb.checked = selectAllSongsCheckbox.checked;
                    if (selectAllSongsCheckbox.checked) {
                        selectedSongIndexes.add(parseInt(cb.dataset.index));
                    }
                });
                updateBatchEditButtons();
            });

            function updateBatchEditButtons() {
                const hasSelection = selectedSongIndexes.size > 0;
                editSelectedBtn.disabled = !hasSelection;
                deleteSelectedBtn.disabled = !hasSelection;
            }

            editSelectedBtn.addEventListener('click', () => {
                if (selectedSongIndexes.size === 0) {
                    alert('Pilih setidaknya satu lagu untuk diedit.');
                    return;
                }
                batchEditArtistInput.value = '';
                batchEditInfoInput.value = '';
                batchEditModal.classList.add('visible');
            });

            batchEditModalCloseBtn.addEventListener('click', () => {
                batchEditModal.classList.remove('visible');
            });

            saveBatchEditBtn.addEventListener('click', () => {
                const newArtist = batchEditArtistInput.value.trim();
                const newInfo = batchEditInfoInput.value.trim();

                if (!newArtist && !newInfo) {
                    alert('Isi setidaknya satu field untuk menerapkan perubahan.');
                    return;
                }

                if (confirm(`Anda yakin ingin menerapkan perubahan ini pada ${selectedSongIndexes.size} lagu terpilih?`)) {
                    let changesMade = false;
                    const sortedIndexes = Array.from(selectedSongIndexes).sort((a, b) => a - b);

                    sortedIndexes.forEach(index => {
                        if (playlist[index]) {
                            if (newArtist) {
                                playlist[index].artist = newArtist;
                                changesMade = true;
                            }
                            if (newInfo) {
                                playlist[index].info = newInfo;
                                changesMade = true;
                            }
                        }
                    });

                    if (changesMade) {
                        savePlaylist();
                        renderSongList(manageSongSearchInput.value);
                        renderDefaultSongSelect();
                        batchEditModal.classList.remove('visible');
                        alert('Perubahan massal berhasil diterapkan!');
                        addLogEntry(`Mengedit ${selectedSongIndexes.size} lagu secara massal (artis: ${newArtist || '[tidak diubah]'}, info: ${newInfo ? 'diubah' : '[tidak diubah]'})`);
                    } else {
                        alert('Tidak ada perubahan yang diterapkan.');
                    }
                    selectedSongIndexes.clear();
                    updateBatchEditButtons();
                }
            });

            deleteSelectedBtn.addEventListener('click', () => {
                if (selectedSongIndexes.size === 0) {
                    alert('Pilih setidaknya satu lagu untuk dihapus.');
                    return;
                }

                if (confirm(`Anda yakin ingin menghapus ${selectedSongIndexes.size} lagu terpilih secara permanen?`)) {
                    const deletedTitles = [];
                    const indexesToDelete = Array.from(selectedSongIndexes).sort((a, b) => b - a);
                    indexesToDelete.forEach(index => {
                        if (playlist[index]) {
                            deletedTitles.push(playlist[index].title);
                            playlist.splice(index, 1);
                        }
                    });
                    savePlaylist();
                    renderSongList(manageSongSearchInput.value);
                    renderDefaultSongSelect();
                    alert(`${indexesToDelete.length} lagu berhasil dihapus.`);
                    addLogEntry(`Menghapus ${indexesToDelete.length} lagu secara massal: ${deletedTitles.join(', ')}`);
                    selectedSongIndexes.clear();
                    updateBatchEditButtons();
                }
            });

            // --- Pencarian di Admin Panel ---
            manageSongSearchInput.addEventListener('input', (event) => {
                renderSongList(event.target.value);
            });


            // --- Logika Edit Lagu (Buka Modal) ---
            manageSongList.addEventListener('click', (event) => {
                const targetButton = event.target.closest('.edit-btn');
                if (targetButton) {
                    const indexToEdit = parseInt(targetButton.dataset.index);
                    const song = playlist[indexToEdit];

                    editSongIndexInput.value = indexToEdit;
                    editSongTitleInput.value = song.title;
                    editSongArtistInput.value = song.artist;
                    editSongSrcInput.value = song.src;
                    editSongAlbumArtInput.value = song.albumArt;
                    editAlbumArtPreview.src = song.albumArt;
                    editSongInfoInput.value = song.info;

                    editSongModal.classList.add('visible');
                }
            });

            // --- Tutup Modal Edit Tunggal ---
            editModalCloseBtn.addEventListener('click', () => {
                editSongModal.classList.remove('visible');
            });
            batchEditModalCloseBtn.addEventListener('click', () => {
                batchEditModal.classList.remove('visible');
            });
            window.addEventListener('click', (event) => {
                if (event.target == editSongModal) {
                    editSongModal.classList.remove('visible');
                } else if (event.target == batchEditModal) {
                    batchEditModal.classList.remove('visible');
                }
            });

            // Preview Album Art for Edit Song
            editSongAlbumArtInput.addEventListener('input', () => {
                const fileName = editSongAlbumArtInput.value.trim();
                if (fileName) {
                    editAlbumArtPreview.src = fileName;
                } else {
                    editAlbumArtPreview.src = 'album_art_default.jpg';
                }
            });
            editAlbumArtPreview.addEventListener('error', () => {
                editAlbumArtPreview.src = 'album_art_default.jpg';
            });


            // --- Simpan Lagu yang Diedit (Tunggal) ---
            saveEditBtn.addEventListener('click', () => {
                const index = parseInt(editSongIndexInput.value);
                if (index < 0 || index >= playlist.length) {
                    alert('Indeks lagu tidak valid.');
                    addLogEntry("Gagal mengedit lagu: Indeks tidak valid.");
                    return;
                }

                const oldTitle = playlist[index].title;
                const newTitle = editSongTitleInput.value.trim();
                const newArtist = editSongArtistInput.value.trim();
                const newAlbumArt = editSongAlbumArtInput.value.trim();
                const newInfo = editSongInfoInput.value.trim();

                if (!newTitle || !newArtist || !newAlbumArt || !newInfo) {
                    alert('Semua field (kecuali Nama File MP3) harus diisi!');
                    return;
                }

                const imageExtensionRegex = /\.(jpg|jpeg|png|gif|webp)$/i;
                if (!imageExtensionRegex.test(newAlbumArt)) {
                    alert('Nama file Album Art harus memiliki ekstensi gambar yang valid (mis: .jpg)!');
                    return;
                }

                const { albumArtExists } = isSrcOrAlbumArtDuplicate(playlist[index].src, newAlbumArt, index);
                if (albumArtExists) {
                    alert('Nama file Album Art sudah ada di playlist (untuk lagu lain)!');
                    return;
                }

                playlist[index].title = newTitle;
                playlist[index].artist = newArtist;
                playlist[index].albumArt = newAlbumArt;
                playlist[index].info = newInfo;

                savePlaylist();
                renderSongList(manageSongSearchInput.value);
                renderDefaultSongSelect();
                editSongModal.classList.remove('visible');
                alert('Lagu berhasil diperbarui!');
                addLogEntry(`Mengedit lagu: "${oldTitle}" menjadi "${newTitle}"`);
            });

            // --- Bersihkan Semua Data ---
            clearDataBtn.addEventListener('click', () => {
                if (confirm('Ini akan menghapus SEMUA lagu dari playlist Anda secara permanen. Lanjutkan?')) {
                    localStorage.removeItem('musicPlaylist');
                    localStorage.removeItem('defaultMelodyVerseSong');
                    localStorage.removeItem('adminActivityLog');
                    localStorage.removeItem('globalMelodyVerseMessage'); // Clear global message
                    playlist = [];
                    adminLog = [];
                    renderSongList();
                    renderDefaultSongSelect();
                    renderAdminLog();
                    loadGlobalMessage(); // Reset global message input
                    alert('Semua data lagu telah dihapus!');
                    savePlaylist();
                    addLogEntry("Membersihkan semua data lagu.");
                }
            });

            // --- Muat Ulang Aplikasi (Client Side) ---
            reloadAppBtn.addEventListener('click', () => {
                reloadMessage.textContent = 'Memuat ulang aplikasi...';
                addLogEntry("Memuat ulang aplikasi (Client Side).");
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            });

            // --- Import Playlist dari File ---
            importPlaylistFile.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) {
                    importExportMessage.style.color = 'red';
                    importExportMessage.textContent = 'Tidak ada file yang dipilih.';
                    addLogEntry("Gagal impor playlist: Tidak ada file dipilih.");
                    return;
                }
                if (file.type !== 'application/json') {
                    importExportMessage.style.color = 'red';
                    importExportMessage.textContent = 'Mohon pilih file JSON yang valid.';
                    addLogEntry("Gagal impor playlist: Format file tidak valid.");
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (Array.isArray(importedData) && importedData.every(song =>
                            song.title && song.artist && song.src && song.albumArt && song.info !== undefined
                        )) {
                            if (confirm('Ini akan mengganti playlist yang ada dengan data yang diimpor. Lanjutkan?')) {
                                playlist = importedData;
                                savePlaylist();
                                renderSongList(manageSongSearchInput.value);
                                renderDefaultSongSelect();
                                importExportMessage.style.color = 'green';
                                importExportMessage.textContent = 'Playlist berhasil diimpor dari file!';
                                addLogEntry("Playlist berhasil diimpor dari file.");
                            } else {
                                importExportMessage.textContent = '';
                                addLogEntry("Impor playlist dari file dibatalkan oleh admin.");
                            }
                        } else {
                            importExportMessage.style.color = 'red';
                            importExportMessage.textContent = 'Format file JSON tidak valid (bukan playlist).';
                            addLogEntry("Gagal impor playlist dari file: Format JSON tidak sesuai struktur playlist.");
                        }
                    } catch (error) {
                        importExportMessage.style.color = 'red';
                        importExportMessage.textContent = 'Gagal memparsing file JSON: ' + error.message;
                        addLogEntry(`Gagal impor playlist dari file: Parsing JSON error - ${error.message}`);
                    }
                };
                reader.onerror = () => {
                    importExportMessage.style.color = 'red';
                    importExportMessage.textContent = 'Gagal membaca file.';
                    addLogEntry("Gagal impor playlist dari file: Kesalahan membaca file.");
                };
                reader.readAsText(file);
                event.target.value = '';
            });

            // --- Import Playlist dari URL ---
            importFromUrlBtn.addEventListener('click', async () => {
                const url = importPlaylistUrlInput.value.trim();
                if (!url) {
                    importExportMessage.style.color = 'red';
                    importExportMessage.textContent = 'Mohon masukkan URL playlist.';
                    addLogEntry("Gagal impor playlist dari URL: URL kosong.");
                    return;
                }

                importExportMessage.style.color = 'orange';
                importExportMessage.textContent = 'Mengunduh playlist dari URL...';

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const importedData = await response.json();

                    if (Array.isArray(importedData) && importedData.every(song =>
                        song.title && song.artist && song.src && song.albumArt && song.info !== undefined
                    )) {
                        if (confirm('Ini akan mengganti playlist yang ada dengan data dari URL. Lanjutkan?')) {
                            playlist = importedData;
                            savePlaylist();
                            renderSongList(manageSongSearchInput.value);
                            renderDefaultSongSelect();
                            importExportMessage.style.color = 'green';
                            importExportMessage.textContent = 'Playlist berhasil diimpor dari URL!';
                            addLogEntry(`Playlist berhasil diimpor dari URL: ${url}`);
                        } else {
                            importExportMessage.textContent = '';
                            addLogEntry("Impor playlist dari URL dibatalkan oleh admin.");
                        }
                    } else {
                        importExportMessage.style.color = 'red';
                        importExportMessage.textContent = 'Data dari URL bukan format playlist yang valid.';
                        addLogEntry(`Gagal impor playlist dari URL: Format data tidak valid - ${url}`);
                    }
                } catch (error) {
                    importExportMessage.style.color = 'red';
                    importExportMessage.textContent = `Gagal mengimpor dari URL: ${error.message}. Pastikan URL benar dan publik.`;
                    addLogEntry(`Gagal impor playlist dari URL: ${error.message} - ${url}`);
                }
                importPlaylistUrlInput.value = '';
            });


            // --- Export Playlist ---
            exportPlaylistBtn.addEventListener('click', () => {
                if (playlist.length === 0) {
                    importExportMessage.style.color = 'red';
                    importExportMessage.textContent = 'Tidak ada lagu di playlist untuk diekspor.';
                    addLogEntry("Gagal ekspor playlist: Playlist kosong.");
                    return;
                }
                const dataStr = JSON.stringify(playlist, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'MelodyVerse_playlist.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                importExportMessage.style.color = 'green';
                importExportMessage.textContent = 'Playlist berhasil diekspor!';
                addLogEntry("Playlist berhasil diekspor.");
            });

            // --- Pengaturan Lagu Default ---
            function renderDefaultSongSelect() {
                defaultSongSelect.innerHTML = '<option value="">-- Pilih dari Playlist --</option>';
                playlist.forEach((song, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${song.title} - ${song.artist}`;
                    defaultSongSelect.appendChild(option);
                });

                const currentDefaultSong = JSON.parse(localStorage.getItem('defaultMelodyVerseSong'));
                if (currentDefaultSong) {
                    const foundIndex = playlist.findIndex(s => s.src === currentDefaultSong.src);
                    if (foundIndex !== -1) {
                        defaultSongSelect.value = foundIndex;
                    } else {
                        defaultSongSelect.value = "";
                        defaultSongMessage.style.color = 'orange';
                        defaultSongMessage.textContent = 'Lagu default sebelumnya tidak ditemukan di playlist. Silakan pilih lagi.';
                    }
                } else {
                    defaultSongSelect.value = "";
                }
            }

            setDefaultSongBtn.addEventListener('click', () => {
                const selectedIndex = parseInt(defaultSongSelect.value);
                if (isNaN(selectedIndex) || selectedIndex < 0 || selectedIndex >= playlist.length) {
                    localStorage.removeItem('defaultMelodyVerseSong');
                    defaultSongMessage.style.color = 'orange';
                    defaultSongMessage.textContent = 'Lagu default dimatikan.';
                    addLogEntry("Lagu default dimatikan.");
                } else {
                    const selectedSong = playlist[selectedIndex];
                    localStorage.setItem('defaultMelodyVerseSong', JSON.stringify(selectedSong));
                    defaultSongMessage.style.color = 'green';
                    defaultSongMessage.textContent = `Lagu default diatur ke: "${selectedSong.title}"`;
                    addLogEntry(`Lagu default diatur ke: "${selectedSong.title}"`);
                }
                window.dispatchEvent(new Event('storage'));
            });


            // --- Toggle Tema untuk halaman Admin ---
            function toggleTheme() {
                document.body.classList.toggle('light-mode');
                const isLightMode = document.body.classList.contains('light-mode');
                localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
                toggleThemeBtn.innerHTML = isLightMode ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
                toggleThemeBtn.setAttribute('aria-label', isLightMode ? 'Beralih ke Mode Gelap' : 'Beralih ke Mode Terang');
            }

            toggleThemeBtn.addEventListener('click', toggleTheme);

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                toggleThemeBtn.innerHTML = '<i class="fas fa-moon"></i>';
                toggleThemeBtn.setAttribute('aria-label', 'Beralih ke Mode Gelap');
            } else {
                document.body.classList.remove('light-mode');
                toggleThemeBtn.innerHTML = '<i class="fas fa-sun"></i>';
                toggleThemeBtn.setAttribute('aria-label', 'Beralih ke Mode Terang');
            }

            if (backgroundVideo) {
                backgroundVideo.play().catch(error => {
                    console.log('Autoplay dicegah di halaman admin. Mungkin diperlukan interaksi pengguna.', error);
                });
            }
        });
    </script>
</body>
</html>
